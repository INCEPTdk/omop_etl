# Clinical Data Tables {#clinical-data-tables}

## Table name: PERSON {#table-name-person}

### Reading from t_person and {#reading-from-t_person-and}

NOTE: course_id is visit reference - unique within department only. It's
possible that there will be duplicate course_ids across different departments.

::: list-table
-

    -   Destination Field
    -   Source Field
    -   Logic
    -   Comment

-

    -   person_id
    -   cpr_enc
    -   Autogenerated integer
    -   Create a record for each distinct patient_id found.\
        In next steps use cours e_id_cpr_mapping file to find row in t_person
        corresponding to course_id

-

    -   gender_concept_id
    -   c_kon
    -   K \~ 8532\
        M \~ 8507\
        else drop person
    -

-

    -   year_of_birth
    -   t_person.d_foddato
    -   Extract year
    -

-

    -   month_of_birth
    -   t_person.d_foddato
    -   Extract month
    -

-

    -   day_of_birth
    -   t_person.d_foddato
    -   Extract day
    -

-

    -   birth_datetime
    -   t_person.d_foddato
    -
    -   Set time to 00:00:00

-

    -   race_concept_id
    -
    -   Map to 0
    -

-

    -   ethnicity_concept_id
    -
    -   Map to 0
    -

-

    -   location_id
    -
    -
    -   NULL

-

    -   provider_id
    -
    -
    -   NULL

-

    -   care_site_id
    -
    -
    -   NULL

-

    -   person_source_value
    -   cpr_enc
    -   \<column_name\>\|\<column_value\>
    -

-

    -   gender_source_value
    -   c_kon
    -   \<column_name\>\|\<column_value\>
    -

-

    -   gender_source_concept_id
    -
    -
    -   NULL

-

    -   race_source_value
    -
    -
    -   NULL

-

    -   race_source_concept_id
    -
    -
    -   NULL

-

    -   ethnicity_source_value
    -
    -
    -   NULL

-

    -   ethnicity_source_concept_id
    -
    -
    -   NULL
:::

## Table name: DEATH {#table-name-death}

### Reading from t_person {#reading-from-t_person}

::: list-table
-

    -   **Destination Field**
    -   **Source Field**
    -   **Logic**
    -   **Comment**

-

    -   **person_id**
    -   v_pid
    -   Only for those patients in PERSON with c_status = 90, look up the
        person_id in the person table by matching the v_pid
        (\<column_name\>\|\<column_value\> format) and the person_source_value
    -

-

    -   **death_date**
    -   d_status_hen_start
    -   When c_status = 90 \[dead\]
    -   Format: YYYY-MM-DD

-

    -   death_datetime
    -
    -
    -   NULL

-

    -   death_type_concept_id
    -
    -   32879 \[Registry\]
    -

-

    -   cause_concept_id
    -
    -
    -   NULL

-

    -   cause_source_value
    -
    -
    -   NULL

-

    -   cause_source_concept_id
    -
    -
    -   NULL
:::

## Table name: VISIT_OCCURENCE {#table-name-visit_occurence}

### Reading from course_metadata, environment variable (SHAK_code) and SHAK code lookup file {#reading-from-course_metadata-environment-variable-shak_code-and-shak-code-lookup-file}

NOTE: Certain variables are nested within course_metadata. The ETL will need to
filter the value column to find data related to admin or disc for example

::: list-table
-

    -   **Destination Field**
    -   **Source Field**
    -   **Logic**
    -   **Comment**

-

    -   **visit_occurrence_id**
    -
    -   Autogenerated integer
    -

-

    -   **person_id**

    -   course_id

    -   Using course_id from course_metadata [having at least ('admdate' or
        'admdatetime']{.underline} [- if both they have to match, else don't
        create a record) and ('dischdate' or 'dischdt']{.underline} [- if both
        they have to match, else don't create a record)]{.underline} for the row
        and joining that on the course_id_cpr_mapping file, find the
        corresponding patient_id

        Use this patient_id (\<column_name\>\|\<column_value\> format) to join
        on the person table with the person_source_value to find the person_id

        Use the person_id

    -

-

    -   **visit_concept_id**
    -   department_type (SHAK code look up file)
    -   First join the SHAK_codes (env variable and the SHAK code look up file)
        then look up the department_type in the concept_look up file by joining
        on the source_code field and the department_type and filtering on
        'visit', use the corresponding standard_concept_id
    -

-

    -   **visit_start_date**
    -   value
    -   When variable = 'admdate' use corresponding value. [If not use
        admdatetime casted into date.]{.underline}
    -

-

    -   visit_start_datetime
    -   value
    -   When variable = 'admdatetime' use corresponding value. [If not use
        admdate with 00:00:00]{.underline}
    -

-

    -   **visit_end_date**
    -   value
    -   When variable = 'dischdate' use corresponding value. [f not use
        'dischdt' casted into date]{.underline}
    -

-

    -   visit_end_datetime
    -   value
    -   When variable = dischdtuse corresponding value. If not use \`dischdate\`
        with 00:00:00
    -

-

    -   **visit_type_concept_id**
    -
    -   32817 \[EHR\]
    -

-

    -   provider_id
    -
    -
    -   NULL

-

    -   care_site_id
    -   SHAK_code (environment variable)
    -   Join on the care_site table using the care_site_source_value and the
        SHAK_code (\<column_name\>\|\<column_value\> format) to find the
        corresponding care_site_id
    -

-

    -   visit_source_value
    -   course_id
    -   \<column_name\>\|\<column_value\>
    -

-

    -   visit_source_concept_id
    -
    -
    -   NULL

-

    -   admitted_from_concept_id

    -   key = 'transfromid'

    -   If key = 'transfromid' and value IS NOT NULL

        Look up value in the semantic mapping document

    -   Once confirmed the following value options will be added to the semantic
        mapping document: "Non-ICU dept. - this hospital" =\> 9201 \[Inpatient
        Visit\] or 8717 \[Inpatient Hospital

        "Other ICU -- other hospital" =\> 32037 \[Intensive Care\]

        "Non-ICU dept. - other hospital" =\> 9201 \[Inpatient Visit\] or 8717
        \[Inpatient Hospital

        "" (blank) =\> \[unknown\]

        "Other ICU -- this hospital" =\> 32037 \[Intensive Care\]

        "Emergency room" =\> 8870 \[Emergency Room -- hospital\] or 9203
        \[Emergency Room Visit\]

-

    -   admitted_from_source_value
    -   Value where key = 'transfromid'
    -   Use 'transfromid\|\<value\>'
    -

-

    -   discharged_to_concept_id

    -

    -   If key = 'chkouttoid'

        Look up value in the semantic mapping document

    -   Once confirmed the following value options will be added to the semantic
        mapping document:

        "Non-ICU dept. - this hospital" =\> 9201 \[Inpatient Visit\] or 8717
        \[Inpatient Hospital

        "Other ICU -- other hospital" =\> 32037 \[Intensive Care\]

        "Non-ICU dept. - other hospital" =\> 9201 \[Inpatient Visit\] or 8717
        \[Inpatient Hospital

        "" (blank) =\> \[unknown\]

        "Other ICU -- this hospital" =\> 32037 \[Intensive Care\]

        "Home" =\> 0 \[Home\]

-

    -   discharged_to_source_value
    -   Value where key = 'chkouttoid'
    -   Use 'chkouttoid\|\<value\>'
    -

-

    -   preceding_visit_occurrence_id
    -
    -
    -   NULL
:::

## Table name: VISIT_DETAIL {#table-name-visit_detail}

Not in scope.

## Table name: STEM {#table-name-stem}

::: list-table
-

    -   Destination Field
    -   Source Field
    -   Logic
    -   Comment

-

    -   domain_id
    -   concept_lookup_stem.std_code_domain
    -
    -

-

    -   datasource
    -
    -   Add the filename from which this record is taken
    -

-

    -   stem_id
    -
    -   Auto-generated integer
    -

-

    -   person_id
    -   course_id
    -   Use course_id from course_metadata for the row and join that on the
        course_id_cpr_mapping file, find the corresponding patient_id\
        Use this patient_id (\<column_name\>\|\<column_value\> format) to join
        on the person table with the person_source_value to find the person_id\
        Use the person_id
    -

-

    -   concept_id
    -   concept_lookup_stem.mapped_standard_code
    -
    -   Use column 'variable' as the base and 'value' as the second component
        for categorical or numerical valuesÂ \
        Lookup based on variable + '\_\_\_' + value\
        (value_type categorical)\
        Lookup based on Lookup based on variable (value_type = numerical). There
        are very few examples of composite data (e.g., pupil sizes in the left
        and right eyes, resp.), and those will be handled on a c ase-by-case
        basis.

-

    -   start_date
    -   \<concept_lookup_stem.start_date\>
    -   Use column of the name defined in the source field, cast to DATE
    -

-

    -   start_datetime
    -   \<concept_lookup_stem.start_date\>
    -   Use column of the name defined in the source field, cast to TIMESTAMPTZ
    -

-

    -   end_date
    -   \<concept_lookup_stem.end_date\>
    -   Use column of the name defined in the source field, cast to DATE
    -

-

    -   end_datetime
    -   \<concept_lookup_stem.end_date\>
    -   Use column of the name defined in the source field, cast to TIMESTAMPTZ
    -

-

    -   type_concept_id
    -   concept_lookup_stem.type_concept_id
    -
    -

-

    -   provider_id
    -
    -
    -   NULL

-

    -   visit_occurrence_id
    -   Course_id
    -   Look up in the visit_occ table by joining on the
        \<column_name\>\_\<column_value\> and the visit_source_value and then
        using the associated visit_occurrence_id
    -

-

    -   visit_detail_id
    -
    -
    -   NULL

-

    -   care_site_id
    -
    -
    -   NULL

-

    -   source_value
    -   \<variable\>\|\<value\>
    -
    -   The same structure is found across all tables. There is a variable and a
        value column and the values in these columns need to be concatenated in
        the source_value, separated by a pipe

-

    -   source_concept_id
    -   uid (mapping file)
    -
    -

-

    -   quantity_or_value_as_number
    -   value (source)
    -
    -   Used for numerical values (from observations or measurement) and
        DRUG_EXPOSURE quantity values

-

    -   value_as_string
    -   value_as_string (mapping file)
    -
    -

-

    -   value_as_concept_id
    -   value_as_concept_id (mapping file)
    -
    -   Used for value_type = 'categorical'

-

    -   unit_concept_id
    -   unit_concept_id (mapping file)
    -
    -

-

    -   value_source_value
    -   value (source)
    -
    -

-

    -   unit_source_concept_id
    -
    -
    -   NULL

-

    -   unit_source_value
    -   unit (mapping file)
    -
    -

-

    -   verbatim_end_date
    -
    -
    -   NULL

-

    -   days_supply
    -
    -
    -   NULL

-

    -   dose_unit_source_value
    -   dose_unit_source_value (mapping file)
    -
    -

-

    -   modifier_concept_id
    -   modifier_concept_id (mapping file)
    -
    -

-

    -   modifier_source_value
    -
    -
    -   NULL

-

    -   measurement_datetime
    -
    -
    -   NULL

-

    -   operator_concept_id
    -   operator_concept_id (mapping file)
    -
    -

-

    -   range_low
    -   range_low (mapping file)
    -
    -

-

    -   range_high
    -   range_high (mapping file)
    -
    -

-

    -   stop_reason
    -
    -
    -   NULL

-

    -   refills
    -
    -
    -   NULL

-

    -   sig
    -
    -
    -   NULL

-

    -   route_concept_id
    -   route_source_value
    -   Join with concept_lookup and use concept_id therefrom
    -

-

    -   route_source_value
    -   route_source_value
    -
    -

-

    -   era_lookback_interval
    -   era_lookback_interval
    -
    -

-

    -   lot_number
    -
    -
    -   NULL

-

    -   unique_device_id
    -
    -
    -   NULL

-

    -   production_id
    -
    -
    -   NULL

-

    -   anatomic_site_concept_id
    -
    -
    -   NULL

-

    -   disease_status_concept_id
    -
    -
    -   NULL

-

    -   specimen_source_id
    -
    -
    -   NULL

-

    -   anatomic_site_source_value
    -
    -
    -   NULL

-

    -   disease_status_source_value
    -
    -
    -   NULL

-

    -   condition_status_concept_id
    -
    -
    -   NULL

-

    -   condition_status_source_value
    -
    -
    -   NULL

-

    -   qualifier_concept_id
    -
    -
    -   NULL

-

    -   qualifier_source_value
    -
    -
    -   NULL

-

    -   event_id
    -
    -
    -   NULL

-

    -   event_field_concept_id
    -
    -
    -   NULL

-

    -   episode_id_source
    -
    -
    -   NULL
:::

## Table name: CONDITION_OCCURRENCE {#table-name-condition_occurrence}

### Reading from STEM (filtered on domain_id = 'Condition') {#reading-from-stem-filtered-on-domain_id-condition}

::: list-table
-

    -   **Destination Field**
    -   **Source Field**
    -   **Logic**
    -   **Comment**

-

    -   **condition_occurrence_id**
    -   Stem_id
    -
    -

-

    -   **person_id**
    -   Person_id
    -
    -

-

    -   **condition_concept_id**
    -   Concept_id
    -   Read concept_id from stem where !=0 or not NULL
    -

-

    -   **condition_start_date**
    -   Start_date
    -
    -

-

    -   condition_start_datetime
    -   Start_datetime
    -
    -

-

    -   **condition_end_date**
    -   End_date
    -   Coalesce(end_date, start_date)
    -

-

    -   condition_end_datetime
    -   End_datetime
    -   If end date, than caste end date as timestamp, else start_datetime
    -

-

    -   **condition_type_concept_id**
    -
    -   32817 \[EHR\]
    -

-

    -   stop_reason
    -
    -
    -   NULL

-

    -   provider_id
    -
    -
    -   NULL

-

    -   visit_occurrence_id
    -   Visit_occurrence_id
    -
    -

-

    -   visit_detail_id
    -
    -
    -   NULL

-

    -   condition_source_value
    -   Source_value
    -
    -

-

    -   condition_source_concept_id
    -   Source_concept_id
    -
    -

-

    -   condition_status_source_value
    -
    -
    -   NULL

-

    -

    -

    -

    -   NULL
:::

```
                                              |  NULL   |
```

## Table name: PROCEDURE_OCCURRENCE {#table-name-procedure_occurrence}

### Reading from STEM (filtered on domain_id = 'Procedure') {#reading-from-stem-filtered-on-domain_id-procedure}

::: list-table
-

    -   **Destination Field**
    -   **Source Field**
    -   **Logic**
    -   **Comment**

-

    -   **procedure_occurrence_id**
    -   Stem_id
    -
    -

-

    -   **person_id**
    -   Person_id
    -
    -

-

    -   **procedure_concept_id**
    -   Concept_id
    -
    -

-

    -   **procedure_date**
    -   Start_date
    -
    -

-

    -   procedure_datetime
    -   Start_datetime
    -
    -

-

    -   procedure_end_date
    -   End_date
    -
    -

-

    -   procedure_end_datetime
    -   End_datetime
    -
    -

-

    -   **procedure_type_concept_id**
    -
    -   32817 \[EHR\]
    -

-

    -   modifier_concept_id
    -   Modifier_concept_id
    -
    -

-

    -   quantity
    -   Quantity
    -
    -

-

    -   provider_id
    -
    -
    -   NULL

-

    -   visit_occurrence_id
    -   Visit_occurrence_id
    -
    -

-

    -   visit_detail_id
    -
    -
    -   NULL

-

    -   procedure_source_value
    -   Source_value
    -
    -

-

    -   procedure_source_concept_id
    -   Source_concept_id
    -
    -

-

    -   modifier_source_value
    -   Modifier_source_value
    -
    -
:::

## Table name: DEVICE_EXPOSURE {#table-name-device_exposure}

### Reading from STEM (filtered on domain_id = 'Device') {#reading-from-stem-filtered-on-domain_id-device}

::: list-table
-

    -   **Destination Field**
    -   **Source Field**
    -   **Logic**
    -   **Comment**

-

    -   **device_exposure_id**
    -   stem_id
    -
    -

-

    -   **person_id**
    -   person_id
    -
    -

-

    -   **device_concept_id**
    -   concept_id
    -
    -

-

    -   **device_exposure_start_date**
    -   start_date
    -
    -

-

    -   device_exposure_start_datetime
    -   start_datetime
    -
    -

-

    -   device_exposure_end_date
    -   end_date
    -
    -

-

    -   device_exposure_end_datetime
    -   end_datetime
    -
    -

-

    -   **device_type_concept_id**
    -
    -   32817 \[EHR\]
    -

-

    -   unique_device_id
    -
    -
    -

-

    -   production_id
    -
    -
    -

-

    -   quantity
    -
    -
    -

-

    -   provider_id
    -
    -
    -

-

    -   visit_occurrence_id
    -   visit_occurrence_id
    -
    -

-

    -   visit_detail_id
    -
    -
    -

-

    -   device_source_value
    -   source_value
    -
    -

-

    -   device_source_concept_id
    -   source_concept_id
    -
    -

-

    -   unit_concept_id
    -   unit_concept_id
    -
    -

-

    -   unit_source_value
    -   unit_source_value
    -
    -

-

    -   unit_source_concept_id
    -
    -
    -
:::

## Table name: MEASUREMENT {#table-name-measurement}

### Reading from STEM (filtered on domain_id = 'Measurement') {#reading-from-stem-filtered-on-domain_id-measurement}

::: list-table
-

    -   **Destination Field**
    -   **Source Field**
    -   **Logic**
    -   **Comment**

-

    -   **measurement_id**
    -   stem_id
    -
    -

-

    -   **person_id**
    -   person_id
    -
    -

-

    -   **measurement_concept_id**
    -   concept_id
    -
    -

-

    -   **measurement_date**
    -   start_date
    -
    -

-

    -   measurement_datetime
    -   start_datetime
    -
    -

-

    -   measurement_time
    -
    -
    -   NULL

-

    -   **measurement_type_concept_id**
    -
    -   32817 \[EHR\]
    -

-

    -   operator_concept_id
    -   operator_concept_id
    -
    -

-

    -   value_as_number
    -   value_as_number
    -
    -

-

    -   value_as_concept_id
    -   value_as_concept_id
    -
    -

-

    -   unit_concept_id
    -   unit_concept_id
    -
    -

-

    -   range_low
    -   Range_low
    -
    -   NULL

-

    -   range_high
    -   Range_high
    -
    -   NULL

-

    -   provider_id
    -
    -
    -   NULL

-

    -   visit_occurrence_id
    -   visit_occurrence_id
    -
    -

-

    -   visit_detail_id
    -
    -
    -   NULL

-

    -   measurement_source_value
    -   source_value
    -
    -

-

    -   measurement_source_concept_id
    -   source_concept_id
    -
    -

-

    -   unit_source_value
    -   unit_source_value
    -
    -

-

    -   unit_source_concept_id
    -
    -
    -   NULL

-

    -   value_source_value
    -   value_as_number
    -
    -

-

    -   measurement_event_id
    -
    -
    -

-

    -   meas_event_field_concept_id
    -
    -
    -
:::

## Table name: SPECIMEN

### Reading from STEM (filtered on domain_id = 'Specimen')

NB! To be added

## Table name: OBSERVATION {#table-name-observation}

### Reading from STEM (filtered on domain_id = 'Observation') {#reading-from-stem-filtered-on-domain_id-observation}

::: list-table
-

    -   **Destination Field**
    -   **Source Field**
    -   **Logic**
    -   **Comment**

-

    -   **observation_id**
    -   stem_id
    -
    -

-

    -   **person_id**
    -   person_id
    -
    -

-

    -   **observation_concept_id**
    -   concept_id
    -
    -

-

    -   **observation_date**
    -   start_date
    -
    -

-

    -   observation_datetime
    -   start_datetime
    -
    -

-

    -   **observation_type_concept_id**
    -
    -   32817 \[EHR\]
    -

-

    -   value_as_number
    -   value_as_number
    -
    -

-

    -   value_as_string
    -   value_as_string
    -
    -

-

    -   value_as_concept_id
    -   value_as_concept_id
    -
    -

-

    -   qualifier_concept_id
    -
    -
    -

-

    -   unit_concept_id
    -   unit_concept_id
    -
    -

-

    -   provider_id
    -
    -
    -   NULL

-

    -   visit_occurrence_id
    -   visit_occurrence_id
    -
    -

-

    -   visit_detail_id
    -
    -
    -   NULL

-

    -   observation_source_value
    -   source_value
    -
    -

-

    -   observation_source_concept_id
    -   source_concept_id
    -
    -

-

    -   unit_source_value
    -   unit_source_value
    -
    -

-

    -   qualifier_source_value
    -
    -
    -

-

    -   value_source_value
    -   value_source_value
    -
    -

-

    -   observation_event_id
    -
    -
    -

-

    -   obs_event_field_concept_id
    -
    -
    -
:::

## Table name: DRUG_EXPOSURE {#table-name-drug_exposure}

### Reading from STEM (filtered on domain_id = 'Drug') {#reading-from-stem-filtered-on-domain_id-drug}

::: list-table
-

    -   **Destination Field**
    -   **Source Field**
    -   **Logic**
    -   **Comment**

-

    -   **drug_exposure_id**
    -   Stem_id
    -
    -

-

    -   **person_id**
    -   Person_id
    -
    -

-

    -   **drug_concept_id**
    -   Concept_id
    -
    -

-

    -   **drug_exposure_start_date**
    -   Start_date
    -
    -

-

    -   drug_exposure_start_datetime
    -   Start_datetime
    -
    -

-

    -   **drug_exposure_end_date**
    -   End_date
    -
    -

-

    -   drug_exposure_end_datetime
    -   End_datetime
    -
    -

-

    -   verbatim_end_date
    -
    -
    -   NULL

-

    -   **drug_type_concept_id**
    -
    -   32817 \[EHR\]
    -

-

    -   stop_reason
    -
    -
    -   NULL

-

    -   refills
    -
    -
    -

-

    -   quantity
    -   Quantity
    -
    -

-

    -   days_supply
    -
    -
    -   NULL

-

    -   sig
    -
    -
    -   NULL

-

    -   route_concept_id
    -   Route_concept_id
    -
    -

-

    -   lot_number
    -
    -
    -   NULL

-

    -   provider_id
    -
    -
    -   NULL

-

    -   visit_occurrence_id
    -   Visit_occurrence_id
    -
    -

-

    -   visit_detail_id
    -
    -
    -   NULL

-

    -   drug_source_value
    -   Source_value
    -
    -

-

    -   drug_source_concept_id
    -   Source_concept_id
    -
    -

-

    -   route_source_value
    -   Route_source_value
    -
    -

-

    -   dose_unit_source_value
    -
    -
    -
:::

## Table name: OBSERVATION_PERIOD {#table-name-observation_period}

### Reading from clinical tables (including visit_occ) {#reading-from-clinical-tables-including-visit_occ}

NOTE: min/max dates all established from dates across all filled in clinical
tables

::: list-table
-

    -   **Destination Field**
    -   **Source Field**
    -   **Logic**
    -   **Comment**

-

    -   **observation_period_id**
    -
    -   Autogenerated integer
    -

-

    -   **person_id**
    -
    -   CREATE observation period for each person_id in PERSON
    -

-

    -   **observation_period_start_date**
    -
    -   MIN(EVENT \[START\] DATES)
    -

-

    -   **observation_period_end_date**
    -
    -   MAX(EVENT \[END\] DATES)
    -

-

    -   **period_type_concept_id**
    -
    -   32817 \[EHR\]
    -
:::
